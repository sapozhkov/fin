# Торговый Бот

```
Из первой итерации вынес вот это:
1. количество денег на рынке постоянно
2. чтобы кто-то заработал, кто-то должен потерять
3. подавляющую часть торгов ведут роботы
4. и если тебя просчитают, на тебе заработают (а ты, соответственно, потеряешь)

Из второй:
5. нет там закономерностей, чистый рандом
6. так что лишний раз не дергаейся
7. и потери неизбежны, так что смотри на сумму прибыли (% / абсолют)
8. если все получается, постарайся не отсвечивать

9. цитата Эдиссона правдива, так что экспериментируй

10. если хочешь что-то сделать в последний момент, то лучше ничего не делай
11. готовь план действий заранее в текстовом/программном виде  

---

Я не терпел поражений. Я просто нашёл 10 000 способов, которые не работают.
(c) Томас Эдисон
````

Этот проект представляет собой торгового бота, разработанного для автоматизации торговых операций на финансовых рынках. 
Бот использует API Tinkoff Invest для выполнения операций купли-продажи ценных бумаг.

## Основные Функции

- **Автоматическая торговля**: Бот может автоматически совершать сделки на основе предопределенных торговых стратегий.
- **Мониторинг рынка**: Бот отслеживает изменения цен на выбранные инструменты в реальном времени.
- **Логирование сделок**: Все сделки записываются в базу данных для последующего анализа.

## Начало Работы

Для запуска бота необходимо:

1. Установить Python версии 3.8 или выше.
2. Клонировать репозиторий проекта.
3. Установить зависимости, используя `pip install -r requirements.txt`.
4. Настроить параметры доступа к API Tinkoff Invest в файле конфигурации.
5. Установить миграции `flask db upgrade`


## Модели и миграции БД

база живет тут `/db/db.sqlite`

1. добавляем в `app.models` по аналогии с имеющимися
2. добавляем миграцию `flask db migrate -m "desc"`
3. применяем её `flask db upgrade`
4. откатываем если надо так `flask db downgrade`

## Конфигурация

Перед первым запуском необходимо настроить параметры бота в файле `.env`:

- `INVEST_TOKEN`: Токен доступа к Tinkoff Invest API.
- `PASSWORD` Пароль для доступа в админку
- `DEBUG` флаг дебаг режима админки
- `SECRET_KEY` ключ для генерации cookies админки 
- `INSTRUMENT_ON_THRESHOLD` % профита, на котором инструмент активируется после ежедневного теста 
- `ACC_BALANCE_CORRECTION` какую часть баланса аккаунта использовать в торговле. 
                           1 ничего не меняем, 0.9 - -10%, 2 - х2 для мажоритарной

Только на проде
- `DATABASE_URL`=postgresql://fin_user:pass@localhost/fin_db

## Запуск

для 1 инструмента 
```bash
python bot.py
```

для сразу нескольких
```bash
python starter.py
```

админка
```bash
python web_server.py
```

для тестов алгоритмов можно поиграть в файлах t_year_m.ipynb (на длинном промежутке)
или t_day_vis.ipynb (в рамках одного дня, но с визуализацией текущего алгоритма и реальных торгов)

## Проблемы с установкой требуемых библиотек

помогла пачка команд

```
python -m ensurepip --upgrade
python -m pip install --upgrade setuptools
pip install --upgrade setuptools
```