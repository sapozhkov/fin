{% extends 'admin/master.html' %}

{% block body %}
    <div class="container mt-4">
        <div id="run-table-container">
            {% include 'admin/run_table.html' %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function fetchRuns() {
                if (document.visibilityState !== 'visible')
                    return;

                fetch('{{ url_for('admin.get_runs') }}')
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById('run-table-container').innerHTML = html;
                    })
                    .catch(error => console.error('Error fetching runs:', error));
            }

            // Fetch runs every 30 seconds
            setInterval(fetchRuns, 30000);

            // Initial fetch
            fetchRuns();

            // Check if the document's visibility state is 'visible' and send a request for updates
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    fetchRuns();
                }
            });
        });
    </script>
{% endblock %}
